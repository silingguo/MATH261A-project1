---
title: "The Relationship Between the COVID-19 Cases and the Demand of Ventilators"
subtitle: "Can Case Numbers Predict the Medical Demand?"
author: "Siling Guo"
thanks: "Project repository available at: [https://github.com/silingguo/MATH261A-project1](https://github.com/silingguo/MATH261A-project1)."
date: 2025-10-29
date-format: long
abstract: "This study explores the effect of new COVID-19 cases on ventilator demand during the COVID-19 pandemic. A simple linear regression model was established using data from the County of Santa Clara Public Health Department. In the model, we use a weighted index that combines daily and 7-day average case data as the independent variable, and daily ventilator demand as the dependent variable. The results show a positive correlation, with an expected increase of 1.2 units in ventilator demand for each point increase in the weighted index (p < 0.001, R^2 = 0.78). However, applying a simple regression model to time-series data has limitations, and this model may not have strong predictive power."
format: pdf
bibliography: references.bib
number-sections: true

---

```{r}
#| include: false 
#| warning: false
#| message: false

library(dplyr)
library(lubridate)
library(ggplot2)
library(broom)
library(flextable)
library(scales)
library(readr)
COVID_19_hospitalizations_by_date_20250917 <- read_csv("../data/COVID-19_hospitalizations_by_date_20250917.csv")
View(COVID_19_hospitalizations_by_date_20250917)
```

# Introduction

One major symptom of a severe COVID-19 infection is a low blood oxygen saturation level, which is often treated by mechanical ventilation. During the 2020-2023 COVID-19 pandemic, the spread of the virus before the availability of effective treatments and vaccines caused an influx of demand for ventilators [@filip_global_2022]. Although the pandemic has ended, analyzing the relationship between the number of COVID-19 cases and ventilator demand may illustrate how medical equipment needs are affected by a surge in new patients during the beginning stages of a pandemic. 

Our hypothesis is that an increase in the number of COVID-19 patients is followed by an increase in ventilator usage. The relationship is tested by using a linear regression model based on time-series data published by the County of Santa Clara Public Health Department (SCCPHD). 

We constructed a new independent variable, which we will call the Severity Score, which combines the daily new cases and the 7-day average new cases. We built this variable to smooth the data and show the general trend more clearly. The construction method will be shown in detail in the Data section. The number of patients on ventilators is the dependent variable. The results show a positive correlation, but the model’s prediction is limited because the data are time-series, which may be affected by dependent error and unequal variance. We will discuss this issue later in the Discussion section.

In this paper, we will first discuss the research background and proposal, then describe the data usage and new variable construction and processing. Next, we explain the setup and validation of the model, as well as its limitations. After presenting the results with relevant tables and graphs, we present the findings and discuss the limitations 


# Data {#sec-data}

In this study, we used the daily counts of new COVID-19 cases and the number of patients on ventilators from March 27, 2020 to May 23, 2021 [@noauthor_covid-19_nodate], provided by the SCCPHD and posted on the County of Santa Clara Open Data Portal. This time period represents the beginning of the COVID-19 pandemic. The World Health Organization (WHO) declared a pandemic in March 2020 due to the rising number of COVID-19 infections. By May 2021, several vaccines became available, which controlled the spread of the pandemic. The total sample size is 423 days with no missing values in the core variables. A small number of outliers were retained, as they likely reflect the peak pandemic conditions. 

Overall, the data are clean, so the only processing performed was converting date strings into a datetime format as well as scaling and normalizing the key data. 
The original dataset consists of time-series data, the error terms are neither independent nor identically distributed, and may lead to misleading results due to fluctuations and time lag. This data does not meet the basic assumptions of regression analysis [@lidf2025coint]. 

To reduce the ‘noise’ of time-series data and improve the predictive performance, we applied a Weighted Moving Average (WMA) to construct a scaled weighted index, Severity Score, as the independent variable.
$$
Severity = (0.2 \times \text{daily new case count}) + (0.8 \times \text{7-day average percentage})
$$
According to[@Huang2020ClinicalFeatures], the median time from illness onset to shortness of breath is 7 days. We assumed that the 7-day average case percentage reflects the overall trend better, so we gave it a higher weight (80%), while the daily new cases show short-term changes and were given a smaller weight (20%). Because the two variables use different units(counts and percentages), the Severity does not directly correspond to the magnitude of ventilator demand. For ease of understanding and presentation, the values were then scaled to a 0–100 range for statistical convenience. The score does not represent the actual number of cases; it only reflects the severity as defined by the index. 

The dependent variable is the number of patients on ventilators, which is a continuous variable measured in terms of the number of people. According to the data summary (@tbl-summary-table), the median composite severity score is 24.1 with a standard deviation of 25 and a maximum of 100, showing considerable variation. The daily average number of patients using ventilators is 179.7, with a standard deviation of 34.5. This data shows smaller fluctuations. Overall, the trend in the number of patients using ventilators is generally consistent with the trend in the number of new COVID-19 cases (@fig-tren-plot). Despite accounting for the time lag, the inherent limitations of time series analysis cannot be fully avoided. Limitations will be discussed in the discussion section.


\newpage


```{r}
#| echo: false
#| warning: false
#| message: false
#| tbl-cap: "Data Summary of Composite Covid-19 Cases and Number of Patients on Ventilators"
#| label: tbl-summary-table


#cleaning data
hos_data <- COVID_19_hospitalizations_by_date_20250917
hos_data <- hos_data %>% 
  mutate(
    covid_pct_numeric = as.numeric(gsub("%", "", covid_pct_7davg)) / 100,
    covid_new_numeric = as.numeric(covid_new)#standardize the scale of two variables
  ) %>%
  dplyr::filter(!is.na(covid_pct_numeric) & !is.na(covid_new_numeric)) %>%
  mutate(
    hos_Date = as.Date(Date),
    covid_new_standardize = as.numeric(scale(covid_new_numeric,center = TRUE, scale = TRUE)),
    covid_pct_standardize = as.numeric(scale(covid_pct_numeric,center = TRUE, scale = TRUE)),
    composite = 0.8 * covid_pct_standardize + 0.2 * covid_new_standardize,#weighting method
    covid_score = rescale(composite, to = c(0, 100))#rescale the composite data 
  )
#summary the data of two variables
summary_stat <- hos_data %>%
  dplyr::summarise(
    covidscore_mean = mean(covid_score,na.rm = T),
    covidscore_sd = sd(covid_score,na.rm = T),
    covidscore_max = max(covid_score,na.rm = T),
    covidscore_min = min(covid_score,na.rm = T),
    ventspts_mean = mean(vents_pts,na.rm = T),
    ventspts_sd = sd(vents_pts,na.rm = T),
    ventspts_max = max(vents_pts,na.rm = T),
    ventspts_min = min(vents_pts,na.rm = T)
)%>%
  tidyr::pivot_longer(cols = everything(),
                      names_to = c("variable", "stat"),
                      names_sep = "_") %>%
  tidyr::pivot_wider(names_from = variable, values_from = value) %>%
  dplyr::mutate( stat = dplyr::recode(stat,mean = "Mean",sd   = "Standard Deviation",max  = "Maximum",min  = "Minimum"),
    stat = factor(stat, levels = c("Mean", "Standard Deviation", "Maximum", "Minimum"))
    )


#set up the column name and make a table by using flextable() function
colnames(summary_stat) <- c("Statistic", "COVID-19 Composite Severity Score", "Patients on Ventilators")

data_summary_table <- flextable(summary_stat) %>%
  add_header_lines(values = "Data Summary of composite Covid-19 cases and Number of patients on ventilators")%>%
  set_table_properties(width = 1, layout = "autofit") %>%
  autofit() %>%
  align(align = "center", part = "all") %>%
  fontsize(size = 7, part = "all") %>%
  bold(part = "header")

data_summary_table   



```



```{r fig.width=8, fig.height=5}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Trends Over Time"
#| label: fig-tren-plot

ggplot(hos_data, aes(x = Date)) +
  geom_line(aes(y = covid_score,group = 1, color = "COVID-19 Composite Severity Score"), linewidth = 0.8) +
  geom_line(aes(y = vents_pts, group = 2,color = "Ventilator Patients"), linewidth = 0.8) +
  scale_color_manual(
    values = c("COVID-19 Composite Severity Score" = "red", "Ventilator Patients" = "blue")
  ) +
  labs(
    title = "Trends Over Time",
    subtitle = "2020/3/27-2021/5/23",
    x = "Date",
    y = "Value"
  ) +
  theme_minimal() 
```


\newpage

# Methods


The score of COVID-19 severity and the number of patients on ventilators are continuous variables. The trend chart of the data suggests a potential linear correlation between two variables. We apply a simple linear regression model. 
$$
Y_i = \beta_0 + \beta_1 X_i + \varepsilon_i
$$
The dependent variable, $Y_i$, represents the number of patients on ventilators on a given day. The independent variable, $X_i$, represents the COVID-19 composite severity score on a given day. The intercept, $\beta_0$, represents the average number of patients on ventilators when the composite severity score is 0. The slope, $\beta_1$, represents the expected change in the number of patients using ventilators for each additional unit of COVID-19 composite severity. The error, $\varepsilon_i$, represents the error term. 
In this model, the weighted method and scale method was used to clean up the data, the ordinary least squares (OLS) method was used to estimate the parameters. To ensure valid inference, we need to meet these four assumptions:

**Linearity**: The scatter plot (@fig-model-plot) shows that two variables are linearly correlated; the number of ventilators increases as the Severity Score increases in general.

**Independence of error**: The Residual vs Time plot (@fig-RT-plot) shows that the residuals are clustering and exhibit a cyclical pattern. This pattern indicates the errors are dependent, which may lead to underestimated standard errors

**Equal Variance of error**: The Residual vs Predictor plot (@fig-RP-plot) shows that as the predictor increases, the residuals form a cone shape and are clustered. The variance is not constant, so the standard t-test might not give accurate results.

**Normality of error**: If the residuals approximately along the reference line in QQ plot, the residuals are approximately normally distributed.The QQ plot (@fig-quan-plot) indicates that the majority of the residuals closely align with the reference line. A few data points fall below the expected quantiles on the left, while a few data points fall above the expected quantiles. This suggests that there might be outliers. In the Residual histogram (@fig-RH-plot), the density line intuitively shows that the residual distribution is approximately normal, but a higher value on the right tail makes the right side exceed the curve. Together with the QQ plot, the pattern indicates that the normality assumption is not fully satisfied, so the validity of confidence intervals and t-tests may be affected.

The value of measurements of key variables for guiding, predicting, and informing practical applications is limited because time-series data violate several model assumptions.

We applied the R’s lm() function to fit the linear model[@R-base], and we used several R packages to generate a table, manipulate and visualize the data, including dplyr [@R-dplyr], lubridate [@R-lubridate], ggplot2[@R-ggplot2], broom[@R-broom], flextable [@R-flextable], and scales[@R-scales].

```{r,fig.width=8, fig.height=4}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Number of patients on ventilators vs. COVID-19 Composite Severity Score"
#| label: fig-model-plot

covid_vents_mode <- lm(vents_pts~covid_score, data = hos_data)
ggplot(covid_vents_mode, aes(x = covid_score,y = vents_pts) )+
  geom_point(size = 1) +
  geom_smooth(method = "lm", se = TRUE, color = "red", linewidth = 0.5) +
  labs(
    x = "COVID-19 Composite Severity Score",
    y = "Number of patients on ventilators",
    title = "Number of patients on ventilators vs. COVID-19 Composite Severity Score")+
  theme_minimal() 

```

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Residual vs. Time"
#| label: fig-RT-plot


ggplot(hos_data, aes(x = 1:nrow(hos_data), y = residuals(covid_vents_mode))) +
  geom_point() +
  geom_hline(yintercept = 0,color = "red", linewidth = 1) +
  ylab("Residual value") +
  xlab("Time") + 
  ggtitle("Residual vs. Time")+
  theme_minimal()
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Residual vs. Predictor"
#| label: fig-RP-plot


ggplot(hos_data, aes(x = covid_score, y = residuals(covid_vents_mode))) +
  geom_point(alpha = 0.6, size = 2) +
  geom_hline(yintercept = 0, color = "red", linewidth = 1) +
  labs(title = "Residual vs. Predictor",
       x = "Covid Severity Score",
       y = "Residual") +
  theme_minimal()
```

```{r fig.width=8, fig.height=3}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Quantile-quantile plot of residuals"
#| label: fig-quan-plot

covid_vents_mode <- lm(vents_pts~covid_score, data = hos_data)
mod_residuals <- residuals(covid_vents_mode)
mod_fitted <- fitted(covid_vents_mode)
ggplot(data.frame(residual = mod_residuals), aes(sample = residual)) +
  geom_qq() +
  geom_qq_line(color = "red", linewidth = 1) +
  xlab("Theoretical Quantile (Normal Distribution)") +
  ylab("Sample Quantile") + 
  ggtitle("Quantile-Quantile Plot of Residuals")+
  theme_minimal() 
```

```{r fig.width=8, fig.height=3}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Residual Histogram"
#| label: fig-RH-plot

#residual histogram
ggplot(data = NULL, aes(x = residuals(covid_vents_mode))) +
  geom_histogram(aes(y = ..density..),bins = 30, fill = "lightyellow", color = "black", alpha = 0.7) +
  labs(title = "Residual Histogram",
       x = "Residual",
       y = "Frequency") +
  geom_density(color = "red", size = 1) +
  theme_minimal()
```


\newpage

# Results

We conducted a t-test to determine whether the Severity Score influences ventilator demand.
The setup is as follows:
The null hypothesis, $H_0$, represents $\beta_1$ = 0, meaning there is no relationship between the Severity Score and the ventilator demand.

The alternative hypothesis, $H_1$, represents $\beta_1$ $\neq$ 0, meaning the relationship between Severity Score and the ventilator demand is significant.

The results (@tbl-model-table) show that the coefficient for Severity Score is positive (t = 37.37, p < 0.001). Therefore, we reject $H_0$ and conclude that there is a significant relationship between the Severity Score and ventilator demand.

As we discussed above, the time-series data violate the assumptions of equal variance, normality, and independence of the error terms are not fully satisfied. These violations will reduce the t-test's accuracy.
The estimate of covid_score is 1.20, indicating that the linear regression model is highly significant.For every composite severity score point increase during this time period, there is an expected increase of 1.2 ventilator patients. The intercept is 150.62, it is positive because there is ventilator usage for reasons other than COVID-19. Multiple R-squared: 0.777 and Adjusted R-squared: 0.776 indicate a model fit of approximately 77%. 


\newpage



```{r}
#| echo: false
#| warning: false
#| message: false
#| tbl-cap: "Summary of Simple Linear Regression Model"
#| label: tbl-model-table

model_glance <- glance(covid_vents_mode)
model_tidy <- tidy(covid_vents_mode)%>%
  mutate(
    p.value = ifelse(p.value < 0.001, "<0.001", sprintf("%.3f", p.value))
    )
model_summary_table <- flextable(model_tidy) %>%
  add_header_lines(values = "Summary of Simple Linear Regression Model")%>%
  set_header_labels(
    term = "Variable",
    estimate = "Estimate",
    std.error = "Standard error",
    statistic = "T-value",
    p.value = "P-value"
  ) %>%
  colformat_num(j = c("estimate", "std.error", "statistic", "p.value"), digits = 3) %>%
  fontsize(size = 10, part = "all") %>%
  autofit() %>%
  add_footer_lines(values = paste(
    "Residual Standard Error:", round(model_glance$sigma, 1),
    "|R-squared:", round(model_glance$r.squared, 3),
    "| Adjusted R-squared:", round(model_glance$adj.r.squared, 3),
    "| F-statistic:", round(model_glance$statistic, 2)
  ))
model_summary_table

```
# Discussion
Overall, according to the results, the model seems to fit the data well; however, its true explanatory and predictive capabilities is limited. The time-series data we used here violate the assumptions of the simple linear regression model, so the result should be interpreted with caution.

We applied a smoothing method to construct a Severity Score variable to reduce fluctuations in the data, but it does not actually address the temporal dependence in the dataset. The smoothing method is a way to enhance the model’s stability, reduce lag effect; however, it does not fundamentally change characteristics of the time-series data, such as dependence of error and temporal dependence. 

The error term is the basis of statistical inference because it determines how variance and uncertainty are estimated in the model. When its assumptions are not met, the standard errors, t-tests, and confidence intervals become unreliable, weakening both the model’s inference and its predictions. 

If error terms are highly related, the model may misinterpret the relationship between the two variables, giving an underestimated p-value and inflated t-value. In our study, this issue makes it difficult to interpret the real causal relation between new COVID-19 cases and ventilator demand. In reality, ventilator demand is likely influenced by other factors beyond infection severity, such as population age structure, vaccination rates, and seasonal factors.

In practice, the COVID-19 composite Severity Score is inherently difficult to define, and a single score cannot accurately reflect the number of new cases, giving it limited practical value. Moreover, despite consulting multiple sources, we have not found a clear definition of the “appropriate ratio” between the number of new cases and the 7-day average in the weighting method. 

This study intends to explore the effect of COVID-19 new cases on ventilator demand. However, we cannot use this model to examine the relationship due to limitations in the dataset and the regression model. Nevertheless, while the simple linear regression model is limited and cannot fit complex datasets, it is a good starting point to identify the data pattern and gain insight.

\newpage

# References
